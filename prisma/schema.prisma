generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}
// datasource db {
//   provider = "sqlite"
//   url      = env("DATABASE_URL")
// }

// Enums

enum Role {
  EMPLOYER
  JOBSEEKER
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum JobStatus {
  ACTIVE
  EXPIRED
  CLOSED
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  password      String?
  image         String?
  role          Role?

  accounts Account[]
  sessions Session[]

  jobs               Job[] // Employer posts
  applied            Application[] // Jobseeker applications
  bookmarks          Bookmark[]
  jobAlerts          JobAlert[]
  verified           Boolean       @default(false)
  verificationCode   String?
  verificationExpiry DateTime?

  companyname     String?
  companytagline  String?
  companysite     String?
  companylocation String?
  companyemail    String?
  aboutcompany    String?
  contactnumber   String?
  activeworker    String?
  industry        String?
  founded         String?
  requirments     String?
}

model Job {
  id             String    @id @default(cuid())
  title          String
  companyTagline String?
  description    String
  category       String
  level          String
  vacancies      Int
  jobType        String
  location       String
  salary         String
  applyBefore    DateTime?
  otherSkills    String?
  requirments   String?
  about          String?

  status       JobStatus
  createdById  String
  createdBy    User          @relation(fields: [createdById], references: [id])
  applications Application[]
  bookmarks    Bookmark[]
  jobAlerts    JobAlert[]
  // companyLogo  String?       

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Application {
  id          String            @id @default(cuid())
  user        User              @relation(fields: [userId], references: [id])
  userId      String
  job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobId       String
  cv          String
  coverLetter String?
  status      ApplicationStatus @default(PENDING)
}

model Bookmark {
  id     String @id @default(cuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String
  job    Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)
  jobId  String
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model JobAlert {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId     String
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, jobId])
}
